<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>JavaScript Lab Session 2</title>
        <meta name="description" content="Yoann Pigné's personal
                      website. Researcher in computer science, Networks,  dynamic
                      graphs, Mobile ad hoc Networks, Vehicular Ad hoc
                      Networks. Lecturer in CS, web services.">
        <meta name="author" content="Yoann Pigné">
        <meta name="google-site-verification" content="FKKi10AM77zJWOKffGHjTdcaOdN6HyLQSTYZu9T_M-0">
        <meta name="Robots" content="all">
        <meta name="viewport" content="width=device-width">

        <link rel="shortcut icon" href="../../favicon.ico" />

        <!-- For iPad with high-resolution Retina display running iOS ≥ 7: -->
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../images/apple-touch-icon-152x152-precomposed.png">
        <!-- For iPad with high-resolution Retina display running iOS ≤ 6: -->
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../images/apple-touch-icon-144x144-precomposed.png">
        <!-- For iPhone with high-resolution Retina display running iOS ≥ 7: -->
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../images/apple-touch-icon-120x120-precomposed.png">
        <!-- For iPhone with high-resolution Retina display running iOS ≤ 6: -->
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../images/apple-touch-icon-114x114-precomposed.png">
        <!-- For the iPad mini and the first- and second-generation iPad on iOS ≥ 7: -->
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../images/apple-touch-icon-76x76-precomposed.png">
        <!-- For the iPad mini and the first- and second-generation iPad on iOS ≤ 6: -->
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../images/apple-touch-icon-72x72-precomposed.png">
        <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
        <link rel="apple-touch-icon-precomposed" href="../../apple-touch-icon-precomposed.png">



        <link rel="stylesheet" href="../../styles/d94e83c8.main.css"/>
        

    </head>
    <body>
        <!--[if lt IE 10]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->


        <header>
            <div class="container">

	<h3 class="pull-left "><a href="/">Yoann Pigné</a></h3>
	<div class="pull-right" id="favicon"></div>
	<ul class="nav nav-pills  pull-right">
		
			
		
			
		
			
		
			
		
			
		
			
				<li><a href="../../projects/index.html">Projects </a></li>
			
		
			
		
			
				<li><a href="../../publications/index.html">Publications </a></li>
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
				<li><a href="../../contact/index.html">Contact </a></li>
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
				<li><a href="../index.html">Teaching </a></li>
			
		
			
				<li><a href="../../these/index.html">Ph.D. </a></li>
			
		
	</ul>
</div>

        </header>
        <div class="main">
            

<div class="page-info row">

</div>

<div class="jumbotron">
    <div class="container">
        <h1>JavaScript Lab Session 2 <small></small></h1>
        
            <ul class="text-right list-unstyled">
                
                <li>Lab Session on Unit Testing JS server library</li>
                
                <li>Unit Test - BDD - TDD</li>
                
                <li>Client/Server Testing</li>
                
            </ul>
        
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-sx-12">
            

<h1 id="testing-and-drawing">Testing and Drawing</h1>
<h2 id="code-quality-control">Code Quality Control</h2>
<p> A few terms: </p>
<ul>
<li><strong>Unit Tests</strong>: Code dedicated to testing the proper behavior of a software/library/module/app.</li>
<li><strong>TDD (test driven development)</strong>: A development technique that aims at writing unit tests for testing a software before writing the actual software</li>
<li><strong>BDD (Behavior driven development)</strong>: TDD using natural language in order to describe the intended functionalities of a software.</li>
<li><strong>Code coverage</strong> : A measure that indicates how much of a software is actually tested in the unit tests. Usually Code Coverage tools integrate with IDEs and highlight untested portion of code in a project.</li>
</ul>
<h2 id="testing-javascript-projects">Testing JavaScript projects</h2>
<h3 id="on-the-client">On the Client</h3>
<p>Testing client code (i.e. JavaScript) is done with a testing library. The most notorious are:</p>
<ul>
<li><a href="qunitjs.com">QUnit</a></li>
<li><a href="http://jasmine.github.io/">Jasmine</a></li>
<li><a href="http://visionmedia.github.io/mocha/">Mocha</a></li>
</ul>
<h3 id="on-the-server">On the Server</h3>
<p>Depending on the server language/architecture, various unit testing frameworks exist in order to test server code (JUnit for Java...)</p>
<p>If JavaScript is used on the server, most of the popular frameworks also work on the server side (Mocha, Jasmine, but not QUnit)</p>
<h3 id="automation-tools">Automation Tools</h3>
<p>We use automation in order to run the test framework. Grunt and Yeoman can help prepare and configure testing platforms.</p>
<h2 id="developing-and-testing-a-node-library-the-shapes-project">Developing and testing a node library: the <code>shapes</code> project</h2>
<h3 id="install-and-scaffold-the-node-project">Install and scaffold the node project</h3>
<p>the Yeoman  node generator will install the mocha framework in order to test our server side shape library</p>
<pre><code class="language-bash"><span class="built_in">cd</span> shapes <span class="comment"># the one previously created</span>
npm install --global generator-node <span class="comment"># sudo?</span>
yo node</code></pre>
<p>Several node related features are now installed. </p>
<h3 id="update-your-project">Update your Project</h3>
<p>Your <code>shape.js</code> main file sould now be in <code>lib/</code>  </p>
<h3 id="lint-your-code">Lint your Code</h3>
<p>Run <code>grunt jshint</code> on the project until no more error appear.</p>
<h3 id="a-first-unit-test-with-mocha">A first Unit Test with Mocha</h3>
<p>A Mocha test use function <code>describe</code> and <code>it</code> in order to describe the tests to be performed. The assertions can be done with several assertion framework. We first test with nodes&#39;s <code>assert</code> function.</p>
<p>Modify <code>test/shapes_test.js</code> in order to ensure that a &quot;road shape&quot; object with the fowloing attributes has a type equal to &quot;residential&quot; and a name equal to &quot;Rue de Colmar&quot;:</p>
<pre><code class="language-json">{
    "<span class="attribute">building</span>":<span class="value"><span class="literal">false</span></span>,
    "<span class="attribute">highway</span>":<span class="value"><span class="string">"residential"</span></span>,
    "<span class="attribute">_id</span>":<span class="value"><span class="string">"-629863"</span></span>,
    "<span class="attribute">nodes</span>":<span class="value">[
        {    
            "<span class="attribute">y</span>":<span class="value"><span class="number">369.0</span></span>,
            "<span class="attribute">x</span>":<span class="value"><span class="number">708.0</span>
        </span>},
        {
            "<span class="attribute">y</span>":<span class="value"><span class="number">396.0</span></span>,
            "<span class="attribute">x</span>":<span class="value"><span class="number">743.0</span>
        </span>}
    ]</span>,
    "<span class="attribute">name</span>":<span class="value"><span class="string">"Rue de Colmar"</span>
</span>}</code></pre>
<p>Test with <code>grunt mochacli</code></p>
<h3 id="bdd">BDD</h3>
<p>In order to use behavioral testing style we use the <code>chai</code> assertion library. </p>
<pre><code class="language-sh">npm install --save-dev chai</code></pre>
<p>Add chai to the testing file (<code>test/shapes_test.js</code>):</p>
<pre><code class="language-js"><span class="keyword">var</span> should = require(<span class="string">'chai'</span>).should();</code></pre>
<p>Executing this function will add a <code>should</code> property to all Javascript objects. Now we can test in  a behavioral declarative way e.g. :</p>
<pre><code class="language-js">describe(<span class="string">'Function getType'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    it(<span class="string">'should be of type "function"'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
        road1.getType.should.be.a(<span class="string">'function'</span>);
    });
    it(<span class="string">'should return a the string "residential when attribute "highway"  is set accordingly'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
        road1.getType().should.equal(<span class="string">'residential'</span>);
    });
});</code></pre>
<h3 id="test-all-your-project">Test All your Project</h3>
<p>Create a full unit test suite of your library in order to test all the features. </p>
<p>Note that you can nest  calls to function <code>describe</code>.</p>
<p>In the <code>Gruntfile.js</code>  change property <code>reporter</code> to &quot;list&quot; instead of &quot;nyan&quot; to see the list of tests that are executed when doing a <code>grunt mochacli</code>. </p>
<h3 id="code-covering">Code Covering</h3>
<p>How can you be sure that you covered all the features of your code? </p>
<p>Install and configure the code covering framework  <a href="http://blanketjs.org/"><code>blanket.js</code></a> in your project and configure grunt accordingly.</p>
<h3 id="testing-asynchronous-code">Testing Asynchronous Code</h3>
<p>Load the test file <code>eure.json</code> into the test suite using the asynchronous function <code>fs.readFile</code>. Test the number of different shapes created and average area. Make sure the asynchronous call works properly with Mocha.</p>
<h2 id="testing-on-the-client">Testing on the Client</h2>
<p>We want to use your <code>shapes</code> library in the browser. Projects who are used both on the browser and on node need to detect the environment in order to properly setup the library. </p>
<p>The module approach:</p>
<pre><code class="language-js"><span class="keyword">if</span>(<span class="keyword">typeof</span> process === <span class="string">'object'</span> &amp;&amp; process + <span class="string">''</span> === <span class="string">'[object process]'</span>){
    global.publicMethod1 = publicMethod1;
    global.publicMethod2 = publicMethod2;
     <span class="comment">// ...</span>
} <span class="keyword">else</span> {
    global.module = {};
    global.module.publicMethod1 = publicMethod1;
    global.module.publicMethod2 = publicMethod2;
}</code></pre>
<p>We usually use modules that are published on the public <a href="https://www.npmjs.org/">npm  repository</a>. A local lib can be used as well in another local project with <code>bower link</code>. See the <a href="http://bower.io/docs/api/#link">documentation</a>. </p>
<p>In the <code>shapes</code> project:</p>
<pre><code class="language-sh">bower link</code></pre>
<p>Create a new webapp project:</p>
<pre><code class="language-sh">cd ..
mkdir shapesApp
cd shapesApp
yo webapp</code></pre>
<p>In that project we can use our local project:</p>
<pre><code class="language-sh">bower link shapes</code></pre>
<p><code>shapes</code> needs to be added in the <code>test</code> folder too.  The test folder contains : </p>
<ul>
<li>the <code>test/index.html</code> file that sets up the references: <pre><code class="language-html">&lt;script src=&quot;bower_components/chai/chai.js&quot;&gt;&lt;/script&gt;</code></pre>
</li>
<li>the <code>test/spec/test.js</code> file where regular tests can be written</li>
</ul>
<h2 id="drawing-svg-data-with-d3-js">Drawing SVG data with d3.js</h2>
<p>In this new <code>shapesApp</code> project, using the JSON data set and the Object Model of the <code>shapes</code> project, write a function that, given the data model, draws the various shapes (roads, amenities, natural, buildings...) on an svg element.</p>
<p>Private buildings must highlight when the mouse passes over and they must be selectable when clicked.</p>
<p class="text_center"><img src="images/svgMap.png" alt="svg_map" style="width:80%;text-align: center;"></p>




        </div>
    </div>
</div>

        </div>
        <footer>
            <div class="container">
	<p>&copy; Yoann Pigné 2014</p>
</div>

        </footer>


        <script src="../../scripts/dbd26eaf.vendor.js"></script>

        
        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-20560642-1');ga('send','pageview');
        </script>

        
        <script src="../../scripts/20bdd8fe.plugins.js"></script>
</body>
</html>









